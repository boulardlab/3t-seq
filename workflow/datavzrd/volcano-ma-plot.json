{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.16.1.json",
    "autosize": {
        "type": "fit",
        "contains": "padding",
        "resize": true
    },
    "transform": [
        {
            "calculate": "log(datum.baseMean + 1) / log(10)",
            "as": "log10_baseMean"
        },
        {
            "calculate": "-log(datum.padj) / log(10)",
            "as": "enrichment"
        }
    ],
    "params": [
        {
            "name": "opacity",
            "value": 75,
            "bind": {
                "input": "range",
                "name": "Set data points opacity ",
                "min": 1,
                "max": 100
            }
        },
        {
            "name": "pts",
            "select": "point"
        },
        {
            "name": "min_lfc",
            "value": -5,
            "bind": {
                "input": "range",
                "name": "Set log2 fold change minimum value ",
                "min": -20,
                "max": 10
            }
        },
        {
            "name": "max_lfc",
            "value": 5,
            "bind": {
                "input": "range",
                "name": "Set log2 folg change maximum value ",
                "min": -10,
                "max": 20
            }
        },
        {
            "name": "max_enrichment",
            "value": 10,
            "bind": {
                "input": "range",
                "name": "Set maximum enrichment value",
                "min": 1,
                "max": 100
            }
        },
        {
            "name": "use_custom_axis",
            "value": true,
            "bind": {
                "input": "checkbox",
                "name": "Use custom axis? "
            }
        }
    ],
    "hconcat": [
        {
            "width": 500,
            "height": 500,
            "mark": {
                "type": "circle",
                "clip": true,
                "tooltip": {
                    "content": "data"
                },
                "opacity": {
                    "expr": "opacity / 100"
                }
            },
            "encoding": {
                "x": {
                    "field": "log10_baseMean",
                    "type": "quantitative",
                    "title": "Mean Expression (log10)"
                },
                "y": {
                    "field": "log2FoldChange",
                    "type": "quantitative",
                    "title": "Log2 Fold Change",
                    "scale": {
                        "domainRaw": {
                            "expr": "use_custom_axis ? max_lfc > min_lfc ? [min_lfc, max_lfc] : [max_lfc, min_lfc] : null"
                        }
                    }
                },
                "tooltip": [
                    {
                        "field": "gene_name",
                        "type": "nominal"
                    },
                    {
                        "field": "padj",
                        "type": "quantitative"
                    },
                    {
                        "field": "log2FoldChange",
                        "type": "quantitative"
                    },
                    {
                        "field": "baseMean",
                        "type": "quantitative"
                    }
                ],
                "color": {
                    "condition": {
                        "param": "pts",
                        "value": "#4c78a8"
                    },
                    "value": "grey"
                },
                "size": {
                    "condition": {
                        "param": "pts",
                        "value": 500,
                        "empty": false
                    },
                    "value": 50
                }
            },
            "config": {
                "legend": {
                    "disable": true
                }
            }
        },
        {
            "width": 500,
            "height": 500,
            "mark": {
                "type": "circle",
                "clip": true,
                "opacity": {
                    "expr": "opacity / 100"
                }
            },
            "encoding": {
                "x": {
                    "field": "log2FoldChange",
                    "type": "quantitative",
                    "title": "log2 fold change",
                    "scale": {
                        "domainRaw": {
                            "expr": "use_custom_axis ? [min_lfc, max_lfc] : null"
                        }
                    }
                },
                "y": {
                    "field": "enrichment",
                    "type": "quantitative",
                    "title": "Enrichment (-log10 p-value)",
                    "scale": {
                        "domainRaw": {
                            "expr": "use_custom_axis ? [0, max_enrichment] : null"
                        }
                    }
                },
                "tooltip": [
                    {
                        "field": "gene_name",
                        "type": "nominal"
                    },
                    {
                        "field": "padj",
                        "type": "quantitative"
                    },
                    {
                        "field": "log2FoldChange",
                        "type": "quantitative"
                    },
                    {
                        "field": "baseMean",
                        "type": "quantitative"
                    }
                ],
                "color": {
                    "condition": {
                        "param": "pts",
                        "value": "#4c78a8"
                    },
                    "value": "grey"
                },
                "size": {
                    "condition": {
                        "param": "pts",
                        "value": 500,
                        "empty": false
                    },
                    "value": 50
                }
            },
            "config": {
                "legend": {
                    "disable": true
                }
            }
        }
    ]
}